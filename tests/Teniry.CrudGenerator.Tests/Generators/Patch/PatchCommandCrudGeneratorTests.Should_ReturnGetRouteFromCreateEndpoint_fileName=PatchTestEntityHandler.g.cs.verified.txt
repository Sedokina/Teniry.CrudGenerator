//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a crud generator tool.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------
#nullable enable
using Teniry.Cqrs.Commands;
using Teniry.Cqrs.Extended.Exceptions;
using Teniry.Cqrs.Extended.Types.PatchOperationType;
using;
using;
using Mapster;

namespace.Application.TestEntityFeature.PatchTestEntity;
public partial class PatchTestEntityHandler : ICommandHandler<PatchTestEntityCommand>
{
    private readonly _db ; public PatchTestEntityHandler(db)
    {
        _db = db;
    }

    /// <inheritdoc/>
    public async Task HandleAsync(PatchTestEntityCommand command, CancellationToken cancellation)
    {
        var entity = await _db.FindAsync<TestEntity>(new object[] { command.Id }, cancellation);
        if (entity == null)
        {
            throw new EntityNotFoundException(typeof(TestEntity));
        }

        PatchOp.Handle(command.Names, nameof(command.Names), x =>
        {
            entity.Names = x;
        });
        await _db.SaveChangesAsync(cancellation);
    }
}